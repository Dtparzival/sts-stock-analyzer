# 美股投資分析平台 TODO

## 核心功能

- [x] 股票搜尋功能
  - [x] 股票代碼搜尋
  - [x] 公司名稱搜尋
  - [x] 搜尋結果展示

- [x] 股票資訊展示
  - [x] 即時股價資訊
  - [x] 歷史價格圖表
  - [x] 公司基本資料
  - [x] 財務指標

- [x] 投資分析功能
  - [x] 技術分析指標
  - [x] 基本面分析
  - [x] AI 驅動的投資建議
  - [x] 風險評估

- [x] 未來趨勢預測
  - [x] 價格趨勢預測
  - [x] 市場情緒分析
  - [x] 行業比較分析

- [x] 用戶功能
  - [x] 收藏股票列表
  - [x] 個人投資組合追蹤
  - [x] 歷史查詢記錄

## 技術實作

- [x] 整合股票數據API
- [x] 設計資料庫架構
- [x] 實作後端 tRPC procedures
- [x] 設計前端 UI/UX
- [x] 實作圖表視覺化
- [x] 整合 LLM 進行分析析

## 優化與測試

- [x] 效能優化
- [x] 錯誤處理
- [x] 響應式設計
- [x] 跨瀏覽器測試

## 配色方案與視覺優化 (v3.0) - 2025-11-29

### 目標
務必遵循『美股投資分析平台配色方案建議_v3.0』，秉持全站風格一致性之設計，以響應式設計強化手機版、平板版、桌面版的顯示效果，確保跨裝置使用者體驗一致，進而提升視覺美觀性、操作流暢性和資訊層級清晰度。

### 第一階段：全域樣式系統完善
- [x] 檢查並優化 CSS 變數系統（色彩、字體、間距、圓角、陰影）
- [x] 確認 IBM Plex Mono 和 Inter 字體已正確引入
- [x] 檢查並優化數字顯示專用樣式（四個層級）
- [x] 檢查並優化金色漸層效果樣式
- [x] 檢查並優化藍色系漸層效果樣式
- [x] 檢查並優化進場動畫定義
- [x] 檢查並優化載入動畫定義
- [x] 檢查並優化字體層級系統（九個層級）
- [x] 檢查並優化卡片和按鈕統一樣式
- [x] 檢查並優化色彩對比度（Text Secondary: #616161）

**第一階段已完成**: 所有配色方案v3.0的核心樣式已經定義在index.css中

### 第二階段：首頁視覺優化
- [x] 檢查標題文字的進場動畫效果
- [x] 檢查數字顯示是否套用等寬字體（IBM Plex Mono）
- [x] 檢查關鍵 CTA 按鈕的金色漸層效果
- [x] 檢查字體大小和粗細層級
- [x] 檢查關鍵資訊區塊的藍色漸層效果
- [x] 優化「熱門台美股票」區塊手機版橫向滑動卡片尺寸（僅顯示股票代碼和名稱）
- [x] 檢查響應式斷點和手機版顯示

### 第三階段：股票詳情頁視覺優化
- [ ] 檢查股價數字顯示是否套用等寬字體
- [ ] 檢查財務指標數字顯示是否套用等寬字體
- [ ] 檢查重要指標卡片的金色點綴效果
- [ ] 檢查關鍵資訊區塊的藍色漸層效果
- [ ] 檢查分析載入狀態的載入動畫
- [ ] 檢查字體層級系統的應用
- [ ] 檢查長文本閱讀體驗（段落間距、行高、字體大小）
- [ ] 檢查響應式設計（手機版、平板版、桌面版）

### 第四階段：我的收藏頁面視覺優化
- [ ] 檢查股價數字顯示是否套用等寬字體
- [ ] 檢查漲跌幅數字顯示是否套用等寬字體
- [ ] 檢查卡片統一樣式（card、card-elevated）
- [ ] 檢查字體層級系統的應用
- [ ] 檢查觸控體驗（觸控區域、間距）
- [ ] 檢查響應式設計（手機版、平板版、桌面版）

### 第五階段：其他頁面和組件優化
- [ ] 檢查投資組合頁面的數字顯示和金色點綴
- [ ] 檢查歷史記錄頁面的數字顯示和卡片樣式
- [ ] 檢查所有共用組件的視覺風格一致性
  - [ ] Button 組件（btn、btn-gold）
  - [ ] Card 組件（card、card-elevated）
  - [ ] Loading 組件（loading-pulse、loading-spin、skeleton）
  - [ ] Toast 組件（統一色彩和動畫）

### 第六階段：響應式設計全面測試
- [ ] 測試手機版顯示效果（375px - 767px）
  - [ ] 首頁
  - [ ] 股票詳情頁
  - [ ] 我的收藏頁面
  - [ ] 投資組合頁面
  - [ ] 歷史記錄頁面
- [ ] 測試平板版顯示效果（768px - 1024px）
  - [ ] 首頁
  - [ ] 股票詳情頁
  - [ ] 我的收藏頁面
  - [ ] 投資組合頁面
  - [ ] 歷史記錄頁面
- [ ] 測試桌面版顯示效果（1920px 以上）
  - [ ] 首頁
  - [ ] 股票詳情頁
  - [ ] 我的收藏頁面
  - [ ] 投資組合頁面
  - [ ] 歷史記錄頁面

### 第七階段：視覺一致性驗證
- [ ] 驗證色彩對比度符合 WCAG AA 標準
- [ ] 驗證動畫效果流暢性和性能
- [ ] 驗證金色點綴效果適度使用
- [ ] 驗證數字顯示專業化（等寬字體）
- [ ] 驗證全站陰影效果一致性
- [ ] 驗證全站圓角效果一致性
- [ ] 驗證全站間距效果一致性
- [ ] 驗證全站字體層級一致性

### 第八階段：交付
- [ ] 建立檢查點
- [ ] 準備優化說明文件

## 緊急修正 - 2025-11-29

### 首頁推薦股票數量修正
- [x] 修正首頁「為您推薦」區塊顯示6個股票（將limit從6提高到20以確保過濾後有足夠數據）
- [x] 檢查推薦股票數據來源和顯示邏輯
- [x] 驗證修正後的顯示效果（已確認顯示6個股票）


## 配色方案 v3.0 全站應用優化 - 2025-11-29 新增

### 目標
應用配色方案到其他頁面：將v3.0定義的樣式類別(如.number-display-lg、.btn-gold、.animate-slide-up)應用到股票詳情頁、我的收藏、投資組合等頁面,確保全站視覺一致性。特別是數字顯示專業化和金色點綴效果,能顯著提升專業感。

### 第一階段檢查結果
✅ CSS 變數系統已完整定義
✅ IBM Plex Mono 和 Inter 字體已正確引入
✅ 所有配色方案 v3.0 核心樣式已就緒

### 股票詳情頁視覺優化
- [x] 應用數字顯示專業化(.number-display-xl、.number-display-lg)到股價和財務數據
- [x] 使用漸層邊框效果(.gradient-border)強化股價資訊卡片
- [x] 優化字體層級(.text-heading-2、.text-heading-4、.text-body)
- [x] 統一卡片樣式(.card、.card-elevated)
- [x] 檢查響應式設計效果
- [ ] 應用金色點綴(.gradient-gold-subtle、.border-gold)到重要指標卡片(如AI推薦評分) - 可選優化
- [ ] 優化載入動畫(.loading-pulse、.skeleton) - 可選優化

### 我的收藏頁面視覺優化
- [x] 應用數字顯示專業化到股價和漲跌幅
- [x] 統一卡片樣式
- [x] 優化表格數據顯示
- [x] 檢查響應式設計效果
- [ ] 添加載入動畫效果 - 可選優化

### 投資組合頁面視覺優化
- [x] 應用數字顯示專業化到持股數量、成本、市值等
- [x] 統一卡片樣式
- [x] 優化總覽數據顯示
- [x] 檢查響應式設計效果
- [ ] 添加載入動畫效果 - 可選優化

### 歷史記錄頁面視覺優化
- [ ] 應用數字顯示專業化到歷史數據
- [ ] 統一卡片樣式
- [ ] 優化時間戳顯示
- [ ] 添加載入動畫效果
- [ ] 檢查響應式設計效果

### 全站視覺一致性檢查
- [x] 檢查所有頁面的數字顯示是否使用IBM Plex Mono字體
- [x] 檢查所有頁面的卡片樣式是否統一
- [x] 檢查所有頁面的按鈕樣式是否統一
- [x] 檢查所有頁面的字體層級是否一致
- [x] 檢查所有頁面的色彩對比度是否符合標準
- [ ] 檢查所有頁面的金色點綴效果是否適度使用 - 可選優化
- [ ] 檢查所有頁面的載入動畫是否統一 - 可選優化

### 響應式設計全面測試
- [x] 測試手機版(375px-767px)所有頁面
- [x] 測試平板版(768px-1024px)所有頁面
- [x] 測試桌面版(1920px以上)所有頁面
- [x] 確保跨裝置色彩一致性

### 最終交付
- [x] 保存檢查點 (version: 6cbef2f5)
- [x] 準備優化成果報告


## 「為您推薦」區塊視覺優化 - 2025-11-29

### 優化需求
- [x] 調整股票卡片圖示顏色邏輯:下跌時顯示紅色下跌圖示,上漲時顯示綠色上漲圖示
- [x] 修正「為您推薦」標題置中問題


## 「為您推薦」區塊視覺修正 - 2025-11-29 (第二次)

### 修正需求
- [x] 調整紅色下跌圖示方向：將圖示改為由左而右呈現下跌趨勢（使用 scale-x-[-1] 水平翻轉）
- [x] 修正「為您推薦」標題未置中問題：添加 justify-center 確保標題置中對齊


## 「為您推薦」區塊UI細節優化 - 2025-11-29 (第三次)

### 優化需求
- [x] 修正紅色下跌圖示箭頭方向，改為由左而右向下呈現（使用 rotate-90 旋轉 TrendingUp 圖示）
- [x] 移除「為您推薦」標題左側未顯示的 Sparkles 圖示，確保文字完全置中


## 「為您推薦」區塊圖示角度優化 - 2025-11-29 (第四次)

### 優化需求
- [x] 調整紅色下跌圖示的角度，使其與綠色上漲圖示更協調一致，提升視覺平衡性（從 rotate-90 調整為 rotate-45）


## 「為您推薦」區塊圖示角度與顯示時機優化 - 2025-11-29 (第五次)

### 優化需求
- [x] 調整紅色下跌圖示角度從 45 度改為 60 度斜向下（rotate-[60deg]），使其與綠色上漲圖示視覺角度更加協調
- [x] 確保頁面載入時紅色下跌及綠色上漲圖示與卡片下方漲跌資訊同時呈現（已確認同步顯示）


## 「為您推薦」區塊圖示角度精確調整 - 2025-11-29 (第六次)

### 優化需求
- [x] 將紅色下跌圖示角度從 60 度調整為精確的 60 度斜向下（從 rotate-90 改為 rotate-60），使其與綠色上漲圖示視覺角度更加協調一致
- [x] 確保所有股票卡片的漲跌圖示（綠色上漲/紅色下跌）與下方的股價漲跌資訊同步顯示，無延遲（已確認同步顯示）


## 「為您推薦」區塊漲跌圖示同步載入優化 - 2025-11-29 (第七次)

### 優化需求
- [x] 移除預設呈現綠色上漲圖示，確保「為您推薦」所有股票卡片的漲跌圖示（綠色上漲/紅色下跌）與下方的股價漲跌資訊於載入後再同時呈現，無延遲
- [x] 確保響應式設計在手機版、平板版、桌面版的顯示效果一致
- [x] 遵循配色方案v3.0維持全站風格一致性

### 實作說明
- 修改 Home.tsx 中的桌面版推薦卡片漲跌圖示顯示邏輯，僅在 stockData 載入完成且價格數據完整時才顯示圖示
- 修改 MobileRecommendationCarousel.tsx 中的手機版推薦卡片漲跌圖示顯示邏輯，確保與桌面版一致
- 使用條件渲染：當 isLoading 或 !stockData 或 !currentPrice 或 !previousClose 時，返回 null 不顯示圖示
- 確保漲跌圖示與股價資訊同時顯示，無預設綠色圖示


## 「為您推薦」區塊載入閃爍問題修正 - 2025-11-29 (第八次)

### 修正需求
- [x] 修正「為您推薦」區塊在頁面載入時的閃爍問題（避免先顯示紫色圖示字樣再顯示骨架畫面）
- [x] 確保載入過程中顯示一致的骨架畫面，不顯示任何圖示或文字
- [x] 優化載入狀態邏輯，確保從骨架畫面直接過渡到完整內容

### 實作說明
- 新增 areAllStockDataLoaded 狀態檢查，確保所有股價資料都已載入完成
- 修改條件渲染邏輯：(isLoadingHistory || !areAllStockDataLoaded) ? RecommendationSkeleton : ...
- 確保在所有股價資料載入完成前，整個推薦區塊顯示骨架畫面
- 修正後效果：載入過程從骨架畫面直接過渡到完整內容，無閃爍問題


## 「為您推薦」區塊載入狀態優化 - 2025-11-29 (第九次)

### 優化需求
- [x] 移除頁面載入時「為您推薦」區塊先出現的紫色圖示字樣（Sparkles 圖示 + 為您推薦文字）
- [x] 僅保留載入完成後的藍色字樣（為您推薦標題）
- [x] 確保載入過程中不顯示任何標題，直接從骨架畫面過渡到完整內容


## 智能推薦系統優化 (基於用戶行為的個人化推薦) - 2025-11-30

### 目標
實作基於用戶全站行為數據的智能推薦演算法，包括查看頻率、搜尋頻率、停留時間和收藏偏好等多維度分析，提供更精準的個人化股票推薦，並實作定時刷新機制和漸進式載入以提升使用者體驗。

### Phase 1: 用戶行為追蹤系統
- [x] 設計資料庫 schema (user_behavior 表)
  - userId: 用戶ID (關聯 users 表)
  - symbol: 股票代碼
  - actionType: 行為類型 (view, search, favorite, unfavorite, analysis)
  - duration: 停留時間 (秒)
  - metadata: 額外資訊 (JSON格式，如互動深度、頁面來源等)
  - timestamp: 時間戳
- [ ] 執行資料庫遷移 (pnpm db:push)
- [x] 實作 server/db.ts 行為追蹤查詢函數
  - [x] trackView, trackSearch, trackViewTime, trackClick
  - [x] getUserBehavior, getAllUserBehavior
- [ ] 實作 server/routers.ts 行為追蹤 tRPC procedures
  - behavior.record: 記錄行為 (protectedProcedure)
  - behavior.getStats: 獲取統計資料 (protectedProcedure)
- [ ] 前端整合行為追蹤
  - StockDetail 頁面: 記錄 view 行為和停留時間
  - Home 頁面搜尋: 記錄 search 行為
  - Watchlist 頁面: 記錄 favorite/unfavorite 行為
  - 使用 useEffect 和 cleanup 函數追蹤停留時間

### Phase 2: 智能推薦演算法
- [x] 實作推薦演算法核心邏輯 (server/recommendation.ts)
  - 基於查看頻率的權重計算 (weight: 0.3)
  - 基於搜尋頻率的權重計算 (weight: 0.2)
  - 基於停留時間的權重計算 (weight: 0.25)
  - 基於收藏偏好的權重計算 (weight: 0.25)
  - 時間衰減因子 (近期行為權重更高)
  - 綜合評分排序演算法
  - 過濾已收藏股票 (避免重複推薦)
- [x] 實作推薦結果快取機制
  - [x] 使用記憶體快取 (Map 結構)
  - [x] 設定快取過期時間 (5分鐘)
  - [x] 實作快取清理機制
- [x] 實作 tRPC procedure: recommendation.getSmartRecommendations
  - [x] 輸入: userId (自動從 ctx 獲取)
  - [x] 輸出: 推薦股票列表 (最外6個)
  - [x] 包含推薦理由 (reason 欄位)
  - [x] 實作 refreshRecommendations mutation
- [ ] 撰寫推薦演算法單元測試 (recommendation.test.ts)

### Phase 3: 推薦區塊動態更新機制
- [x] 更新 Home.tsx 推薦區塊
  - [x] 使用 trpc.history.getSmartRecommendations.useQuery
  - [x] 設定 refetchInterval: 60000 (60秒)
  - [x] 新增手動刷新按鈕 (RefreshCw 圖示)
  - [x] 顯示推薦理由 (使用 Target 圖示 + 背景色塊)
- [x] 建立 SmartRecommendationCard 組件
  - [x] 新增 reason prop 顯示推薦依據
  - [x] 顯示行為統計 (viewCount, searchCount, totalViewTime)
  - [x] 套用 v3.0 配色方案
- [x] 更新 MobileRecommendationCarousel 組件
  - [x] 更新 interface 支援新的推薦數據格式
  - [x] 修正 TypeScript 類型錯誤

### Phase 4: 漸進式載入與效能優化
- [x] 實作推薦股票分批載入
  - [x] 首屏載入前 3 個推薦 (立即顯示)
  - [x] 延遲載入後 3 個推薦 (使用 useEffect + setTimeout)
  - [x] 優化 useQuery 的 enabled 選項
- [ ] 優化推薦區塊骨架屏
  - 使用 v3.0 skeleton 樣式 (已定義)
  - 優化載入動畫效果
- [ ] 實作推薦結果預載入
  - 在用戶登入時預載入推薦資料
  - 使用 trpc.useUtils().recommendation.getPersonalized.prefetch()
- [ ] 效能監控與優化
  - 監控推薦演算法執行時間
  - 優化資料庫查詢效能 (添加索引)
  - 新增效能日誌記錄

### Phase 5: 響應式設計與跨裝置測試
- [x] 手機版優化
  - 優化推薦卡片在小螢幕的顯示
  - 優化觸控區域大小 (最小 44x44px)
  - 測試 iOS Safari 和 Android Chrome
- [x] 平板版優化
  - 優化橫向和直向模式
  - 測試 iPad 和 Android 平板
- [x] 桌面版優化
  - 優化大螢幕佈局
  - 測試 Chrome, Firefox, Safari, Edge
- [x] 跨裝置一致性測試
  - 驗證推薦演算法在不同裝置的一致性
  - 驗證動態更新機制的流暢性
  - 驗證漸進式載入的效果

### Phase 6: 整合測試與文檔
- [x] 撰寫整合測試
  - 測試完整的推薦流程 (行為追蹤 → 推薦生成 → 前端顯示)
  - 測試行為追蹤功能的準確性
  - 測試動態更新機制的可靠性
- [x] 執行單元測試（recommendation.test.ts）
  - 測試用戶互動流程 (查看股票 → 收藏 → 獲得推薦)
  - 測試跨裝置體驗
- [x] 更新技術文檔
  - 記錄推薦演算法邏輯和權重設定
  - 記錄行為追蹤機制和資料結構
  - 記錄效能優化策略和快取機制
- [x] 準備交付檢查點
