# 美股投資分析平台 TODO

## 核心功能

- [x] 股票搜尋功能
  - [x] 股票代碼搜尋
  - [x] 公司名稱搜尋
  - [x] 搜尋結果展示

- [x] 股票資訊展示
  - [x] 即時股價資訊
  - [x] 歷史價格圖表
  - [x] 公司基本資料
  - [x] 財務指標

- [x] 投資分析功能
  - [x] 技術分析指標
  - [x] 基本面分析
  - [x] AI 驅動的投資建議
  - [x] 風險評估

- [x] 未來趨勢預測
  - [x] 價格趨勢預測
  - [x] 市場情緒分析
  - [x] 行業比較分析

- [x] 用戶功能
  - [x] 收藏股票列表
  - [x] 個人投資組合追蹤
  - [x] 歷史查詢記錄

## 技術實作

- [x] 整合股票數據API
- [x] 設計資料庫架構
- [x] 實作後端 tRPC procedures
- [x] 設計前端 UI/UX
- [x] 實作圖表視覺化
- [x] 整合 LLM 進行分析析

## 優化與測試

- [x] 效能優化
- [x] 錯誤處理
- [x] 響應式設計
- [x] 跨瀏覽器測試

## 「為您推薦」區塊進階功能優化

### 目標
優化登入後首頁的「為您推薦」區塊，實作收藏功能整合、即時股價資訊、智能推薦演算法和動態更新機制，遵循全站風格一致性設計，確保跨裝置使用者體驗一致。

### 第一階段：收藏功能整合
- [x] 在推薦卡片上添加收藏狀態圖標（Heart 圖標，已收藏=實心，未收藏=空心）
- [x] 整合 watchlist.list API 查詢收藏狀態
- [x] 整合 watchlist.add 和 watchlist.remove API 實現一鍵收藏/取消收藏
- [x] 實作樂觀更新策略（onMutate/onError/onSettled）
- [x] 添加 toast 提示提升用戶體驗
- [x] 確保收藏按鈕在手機版有足夠的觸控區域（最小 44x44px）

### 第二階段：即時股價資訊
- [x] 在推薦卡片上顯示當前股價（使用 stock.getStockData API）
- [x] 顯示漲跌幅百分比（綠色為漲，紅色為跌）
- [x] 顯示漲跌金額（絕對值）
- [x] 添加載入狀態（Loader 動畫）
- [x] 添加錯誤處理（顯示最後查看時間作為降級顯示）
- [x] 優化卡片佈局，確保股價資訊不會擠壓其他內容
- [x] 確保響應式設計在不同螢幕尺寸下正常顯示

### 第三階段：智能推薦演算法
- [x] 創建 userBehavior 資料庫表追蹤用戶行為數據
  - userId, symbol, viewCount, searchCount, totalViewTime, lastViewedAt
- [x] 實作 trackUserView 函數記錄查看行為（進入股票詳情頁時觸發）
- [x] 實作 trackUserSearch 函數記錄搜尋行為（搜尋股票時觸發）
- [x] 實作 trackUserViewTime 函數記錄停留時間（離開股票詳情頁時觸發）
- [x] 實作加權評分機制：
  - 收藏權重：5 分
  - 查看頻率權重：viewCount × 0.5 分
  - 搜尋頻率權重：searchCount × 0.3 分
  - 停留時間權重：totalViewTime / 60 × 0.2 分（分鐘）
- [x] 實作 history.getRecommendations API，整合行為數據進行排序
- [x] 整合智能推薦 API 到首頁推薦區塊
- [ ] 編寫單元測試驗證評分邏輯（可選）

### 第四階段：動態更新機制
- [x] 實作定時刷新功能（每 30 秒自動更新股價）
- [x] 添加手動刷新按鈕（RefreshCw 圖標，帶旋轉動畫）
- [x] 實作行為觸發更新（用戶收藏/取消收藏後自動刷新推薦列表）
- [x] 添加刷新中狀態提示（禁用刷新按鈕，顯示旋轉動畫）
- [x] 優化刷新體驗（使用樂觀更新，避免閃爍）

### 第五階段：視覺設計優化
- [ ] 確保所有新增元素遵循全站風格（漸層背景、陰影、圓角）
- [ ] 優化收藏按鈕的 hover 和 active 狀態
- [ ] 優化股價資訊的文字大小和顏色對比
- [ ] 添加 framer-motion 動畫效果（收藏狀態切換、股價更新）
- [ ] 確保響應式設計在手機版、平板版、桌面版都正常顯示

### 第六階段：測試和驗證
- [ ] 測試收藏功能在所有裝置上的操作流暢性
- [ ] 測試即時股價資訊的顯示準確性
- [ ] 測試智能推薦演算法的排序邏輯
- [ ] 測試動態更新機制的時效性
- [ ] 驗證全站風格一致性
- [ ] 儲存檢查點

### 第七階段：市場分類過濾優化
- [x] 調整「為您推薦」區塊的市場過濾邏輯，美股市場只顯示美股股票，台股市場只顯示台股股票
- [x] 確保響應式設計與視覺一致性
- [x] 測試市場切換功能的正確性
- [x] 儲存檢查點

### 第八階段：推薦區塊空狀態優化
- [x] 分析現有空狀態設計並規劃優化方案
- [x] 設計推薦區塊的空狀態組件（遵循全站漸層風格）
- [x] 實作空狀態邏輯（當市場切換後推薦列表為空時顯示）
- [x] 添加友善的引導訊息和操作建議
- [x] 確保響應式設計（手機版、平板版、桌面版）
- [x] 測試美股和台股市場的空狀態顯示
- [x] 儲存檢查點

### 第九階段：空狀態區塊簡化優化
- [x] 移除空狀態組件的圖標（Sparkles icon）
- [x] 縮小空狀態區塊尺寸（減少 padding 和高度）
- [x] 簡化引導訊息文案（更簡潔友善）
- [x] 移除漸層背景裝飾圓形
- [x] 優化按鈕樣式（保持全站風格一致性）
- [x] 確保響應式設計（手機版、平板版、桌面版）
- [x] 測試美股和台股市場的空狀態顯示
- [x] 儲存檢查點

### 第十階段：UX 優化 - 載入狀態與動畫效果
- [x] 為推薦區塊添加骨架屏（skeleton）載入動畫
- [x] 為空狀態組件添加淡入動畫效果（使用 framer-motion）
- [x] 測試並驗證優化效果
- [x] 儲存檢查點

## 「我的收藏」頁面卡片樣式重新設計

### 目標
重新設計「我的收藏」頁面的個股卡片樣式，參考「為您推薦」區塊的設計風格，包含價格、漲跌幅、圖示等完整資訊，並確保響應式設計與全站風格一致性。

### 實作項目
- [x] 分析「為您推薦」區塊的卡片樣式與組件結構
- [x] 重新設計「我的收藏」頁面的卡片佈局
- [x] 添加即時股價資訊顯示（當前價格、漲跌金額、漲跌百分比）
- [x] 添加市場標籤（美股/台股）
- [x] 添加收藏圖示（實心愛心）與趋勢圖示
- [x] 整合 stock.getStockData API 獲取即時股價
- [x] 實作載入狀態與錯誤處理
- [x] 優化卡片樣式（陰影、圓角、間距、顏色）
- [x] 確保響應式設計（手機版、平板版、桌面版）
- [x] 測試並驗證優化效果
- [x] 儲存檢查點

## 「我的收藏」頁面進階功能優化

### 目標
優化「我的收藏」頁面的使用者體驗，添加卡片排序功能並將批量分析結果改為全屏頁面展示，同時確保全站風格一致性與響應式設計。

### 實作項目
- [x] 在「我的收藏」頁面添加卡片排序功能（依價格、漲跌幅、添加時間排序）
- [x] 將批量分析結果的對話框改為全屏頁面展示，提供更好的閱讀體驗
- [x] 確保全站響應式設計，強化手機版、平板版的顯示效果
- [x] 維持全站風格一致性，提升視覺美觀性與操作流暢性
- [x] 測試並驗證優化效果
- [ ] 儲存檢查點
