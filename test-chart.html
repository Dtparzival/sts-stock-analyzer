<!DOCTYPE html>
<html>
<head>
  <title>Recharts K線圖測試</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
</head>
<body>
  <div id="root"></div>
  
  <script>
    const { ComposedChart, XAxis, YAxis, CartesianGrid, Tooltip, Customized, ResponsiveContainer } = Recharts;
    
    // 測試數據
    const data = [
      { date: '10/14', open: 400, high: 410, low: 395, close: 405 },
      { date: '10/15', open: 405, high: 415, low: 400, close: 410 },
      { date: '10/16', open: 410, high: 420, low: 405, close: 415 },
      { date: '10/17', open: 415, high: 425, low: 410, close: 420 },
      { date: '10/18', open: 420, high: 430, low: 415, close: 425 },
    ];
    
    // 自定義 K 線層
    const CandlestickLayer = (props) => {
      const { xAxisMap, yAxisMap, width, height, margin } = props;
      
      console.log('CandlestickLayer props:', props);
      
      if (!xAxisMap || !yAxisMap) return null;
      
      const xAxis = xAxisMap[0];
      const yAxis = yAxisMap['price'];
      
      if (!xAxis || !yAxis) return null;
      
      const xScale = xAxis.scale;
      const yScale = yAxis.scale;
      
      const barWidth = Math.max((width - margin.left - margin.right) / data.length * 0.6, 2);
      
      return React.createElement('g', { className: 'candlestick-layer' },
        data.map((item, index) => {
          const { open, close, high, low } = item;
          const isRising = close >= open;
          const color = isRising ? "#22c55e" : "#ef4444";
          
          const xPos = xScale(item.date) + xScale.bandwidth() / 2;
          const yHigh = yScale(high);
          const yLow = yScale(low);
          const yOpen = yScale(open);
          const yClose = yScale(close);
          
          const candleX = xPos - barWidth / 2;
          const candleY = Math.min(yOpen, yClose);
          const candleHeight = Math.max(Math.abs(yClose - yOpen), 1);
          
          return React.createElement('g', { key: `candle-${index}` },
            React.createElement('line', {
              x1: xPos, y1: yHigh, x2: xPos, y2: Math.min(yOpen, yClose),
              stroke: color, strokeWidth: 1
            }),
            React.createElement('line', {
              x1: xPos, y1: Math.max(yOpen, yClose), x2: xPos, y2: yLow,
              stroke: color, strokeWidth: 1
            }),
            React.createElement('rect', {
              x: candleX, y: candleY, width: barWidth, height: candleHeight,
              fill: color, stroke: color, strokeWidth: 1
            })
          );
        })
      );
    };
    
    // 渲染圖表
    const App = () => {
      return React.createElement('div', { style: { width: '100%', height: 400 } },
        React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
          React.createElement(ComposedChart, {
            data: data,
            margin: { top: 10, right: 10, left: 0, bottom: 0 }
          },
            React.createElement(CartesianGrid, { strokeDasharray: '3 3' }),
            React.createElement(XAxis, { dataKey: 'date' }),
            React.createElement(YAxis, {
              yAxisId: 'price',
              domain: [390, 435]
            }),
            React.createElement(Tooltip, null),
            React.createElement(Customized, { component: CandlestickLayer })
          )
        )
      );
    };
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
